import arcade

SCREEN_WIDTH = 1000
SCREEN_HEIGHT = 650
SCREEN_TITLE = "Кристаллические Приключения - Меню"

class MainMenu(arcade.View):
    def __init__(self):
        super().__init__()
        try:
            self.title_music = arcade.load_sound(":resources:music/funkyrobot.mp3")
            self.music_player = None
        except:
            self.title_music = None

    def on_show(self):
        if self.title_music:
            self.music_player = self.title_music.play(volume=0.2, loop=True)

    def on_hide(self):
        if self.title_music and self.music_player:
            self.title_music.stop(self.music_player)

    def on_draw(self):
        self.clear()
        arcade.set_background_color(arcade.color.DARK_BLUE)

        arcade.draw_text(
            "КРИСТАЛЛИЧЕСКИЕ ПРИКЛЮЧЕНИЯ",
            SCREEN_WIDTH // 2,
            SCREEN_HEIGHT // 2 + 100,
            arcade.color.GOLD,
            45,
            anchor_x="center"
        )

        arcade.draw_text(
            "Выберите действие:",
            SCREEN_WIDTH // 2,
            SCREEN_HEIGHT // 2,
            arcade.color.WHITE,
            30,
            anchor_x="center"
        )

        options = [
            ("1 - Обучающий уровень", arcade.color.GREEN),
            ("2 - Уровень 1", arcade.color.YELLOW),
            ("3 - Уровень 2", arcade.color.ORANGE),
            ("4 - Уровень 3", arcade.color.RED),
            ("5 - Уровень 4", arcade.color.PURPLE),
            ("I - Инструкция", arcade.color.CYAN),
            ("ESC - Выход", arcade.color.LIGHT_GRAY)
        ]

        for i, (text, color) in enumerate(options):
            y_pos = SCREEN_HEIGHT // 2 - 50 - (i * 40)
            arcade.draw_text(
                text,
                SCREEN_WIDTH // 2,
                y_pos,
                color,
                24,
                anchor_x="center"
            )

        arcade.draw_text(
            "M - вкл/выкл музыку",
            SCREEN_WIDTH - 150,
            SCREEN_HEIGHT - 20,
            arcade.color.LIGHT_GRAY,
            14
        )

    def on_key_press(self, key, modifiers):
        if key == arcade.key.KEY_1 or key == arcade.key.NUM_1:
            print("Запуск обучающего уровня...")
            print("Запустите файл tutorial_level.py")
        elif key == arcade.key.KEY_2 or key == arcade.key.NUM_2:
            print("Запуск уровня 1...")
            print("Запустите файл level1.py")
        elif key == arcade.key.KEY_3 or key == arcade.key.NUM_3:
            print("Запуск уровня 2...")
            print("Запустите файл level2.py")
        elif key == arcade.key.KEY_4 or key == arcade.key.NUM_4:
            print("Запуск уровня 3...")
            print("Запустите файл level3.py")
        elif key == arcade.key.KEY_5 or key == arcade.key.NUM_5:
            print("Запуск уровня 4...")
            print("Запустите файл level4.py")
        elif key == arcade.key.I:
            self.show_instructions()
        elif key == arcade.key.M:
            self.toggle_music()
        elif key == arcade.key.ESCAPE:
            arcade.close_window()

    def show_instructions(self):
        instructions_view = InstructionsView()
        self.window.show_view(instructions_view)

    def toggle_music(self):
        if self.title_music:
            if self.music_player:
                self.title_music.stop(self.music_player)
                self.music_player = None
            else:
                self.music_player = self.title_music.play(volume=0.2, loop=True)


class InstructionsView(arcade.View):
    def on_draw(self):
        self.clear()
        arcade.set_background_color(arcade.color.DARK_BLUE)

        arcade.draw_text(
            "ИНСТРУКЦИЯ",
            SCREEN_WIDTH // 2,
            SCREEN_HEIGHT - 50,
            arcade.color.GOLD,
            40,
            anchor_x="center"
        )

        instructions = [
            "Цель игры: Собрать все кристаллы на уровне",
            "",
            "Управление:",
            "← → / A D - Движение влево/вправо",
            "↑ / W / ПРОБЕЛ - Прыжок",
            "ESC - Возврат в меню",
            "M - Включить/выключить музыку",
            "",
            "Опасности:",
            "• Шипы - отнимают жизнь",
            "• Враги - отнимают жизнь",
            "• Падение с платформы - отнимает жизнь",
            "",
            "У вас есть 5 жизней на каждый уровень",
            "Соберите все кристаллы, чтобы пройти уровень!"
        ]

        for i, text in enumerate(instructions):
            y_pos = SCREEN_HEIGHT - 120 - (i * 30)
            color = arcade.color.WHITE
            if "Управление:" in text or "Опасности:" in text or "Цель игры:" in text:
                color = arcade.color.YELLOW
            arcade.draw_text(
                text,
                50,
                y_pos,
                color,
                20
            )

        arcade.draw_text(
            "Нажмите ESC для возврата в меню",
            SCREEN_WIDTH // 2,
            50,
            arcade.color.LIGHT_GRAY,
            20,
            anchor_x="center"
        )

    def on_key_press(self, key, modifiers):
        if key == arcade.key.ESCAPE:
            menu_view = MainMenu()
            self.window.show_view(menu_view)


def main():
    window = arcade.Window(SCREEN_WIDTH, SCREEN_HEIGHT, SCREEN_TITLE)
    menu_view = MainMenu()
    window.show_view(menu_view)
    arcade.run()


if __name__ == "__main__":
    main()
